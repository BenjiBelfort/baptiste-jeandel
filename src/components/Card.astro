---
import FunkyButton from '@/components/FunkyButton.astro';

const {
  title,
  excerpt,
  href,
  ctaLabel = 'En savoir plus',
  secondaryHref,
  secondaryLabel = 'Demander un devis',
  icon,
  image, // <- nouvelle prop
} = Astro.props;

const currentPath = Astro.url.pathname;

let ctaColor = 'bg-sky-300';
if (currentPath.startsWith('/services')) {
  ctaColor = 'redBJ';
} else if (currentPath.startsWith('/formations')) {
  ctaColor = 'bleuBJ';
} else if (currentPath.startsWith('/cours')) {
  ctaColor = 'orangeBJ';
}
---

<article
  class="group relative h-full border border-stone-900 bg-white/80 p-6
         rounded-lg shadow-sm
         transition-all duration-200
         hover:-translate-y-0.5 hover:rotate-[-1deg] hover:shadow-md
         focus-within:ring-2 focus-within:ring-stone-400"
>
  <div class="relative flex h-full flex-col">
    <h3 class="my-6 mx-auto text-4xl hand font-bold text-stone-900 flex items-start gap-2 text-center">
      {icon && <span aria-hidden="true" class="mt-0.5">{icon}</span>}
      {title}
    </h3>

    {image && (
      <img 
        src={image} 
        alt={`Illustration pour ${title}`} 
        class="mx-auto mb-4 max-h-32 object-contain drop-shadow-xl"
        loading="lazy"
      />
    )}

    {excerpt && <p class="mt-2 text-stone-700 text-center px-6 md:px-20">{excerpt}</p>}

    <div class="mt-auto pt-6 flex flex-col md:flex-row gap-3 justify-between">
      {secondaryHref && (
        <FunkyButton
          href={secondaryHref}
          label={secondaryLabel}
          color="bg-slate-300"
        />
      )}

      {href && (
        <FunkyButton
          href={href}
          label={ctaLabel}
          color={ctaColor}
        />
      )}
    </div>
  </div>
</article>
