---
import PageTitle from "@/components/PageTitle.astro";
import StickyDevis from "@/components/StickyDevis.astro";
import StickySectionHint from "@/components/StickySectionHint.astro";

/** Props attendues
 * - title: string
 * - excerpt?: string
 * - domain: string
 * - slug: string
 * - ctaMessage?: string
 * - ctaLabel?: string
 * - image?: string
 * - stickyColor?: string
 */
type Props = {
  title: string;
  excerpt?: string;
  domain: string;
  slug: string;
  ctaMessage?: string;
  ctaLabel?: string;
  image?: string;
  stickyColor?: string;
};

const {
  title,
  excerpt,
  domain,
  slug,
  ctaMessage,
  ctaLabel = "Demander un devis",
  image,
  stickyColor,
} = Astro.props;
---

<!-- Bandeau titre (couleur auto par route via PageTitle) -->
<PageTitle title={title} subtitle={excerpt} />

<!-- Bandeau contextuel sous la nav, auto-couleur par route -->
<StickySectionHint title={title} />

<!-- Illustration chevauchante (pile au px) -->
{image && (
  <div class="relative z-10 h-48 -mt-6">  <!-- hauteur fixe + chevauchement -->
    <img
      src={image}
      alt={`Illustration â€” ${title}`}
      class="h-48 max-h-48 w-auto max-w-[75vw] mx-auto object-contain drop-shadow-xl
             absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"
      loading="lazy"
      decoding="async"
      fetchpriority="low"
    />
  </div>
)}


<!-- Contenu rich text -->
<article class="prose max-w-3xl mx-auto px-4 pb-28 mdx">
  <slot />
</article>

<!-- CTA sticky bas de page -->
<StickyDevis
  domain={domain}
  origin={`${Astro.url.pathname.startsWith('/services') ? 'services' : 'formations'}/${slug}`}
  message={ctaMessage}
  label={ctaLabel}
  color={stickyColor}
/>
